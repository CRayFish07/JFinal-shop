<!doctype html>
<html class="no-js fixed-layout">
<head>
<% include("/common/shop_head.html"){}%>
<script type="text/javascript">
$().ready(function() {

	var $safeAnswer = $("input[name='member.safeAnswer']");

	// 表单验证
	$("#passwordRecoverForm").validate({
		errorClass: "validateError",
		errorPlacement: function(error, element) {
			var messagePosition = element.metadata().messagePosition;
			if("undefined" != typeof messagePosition && messagePosition != "") {
				var $messagePosition = $(messagePosition);
				if ($messagePosition.size() > 0) {
					error.insertAfter($messagePosition).fadeOut(300).fadeIn(300);
				} else {
					error.insertAfter(element).fadeOut(300).fadeIn(300);
				}
			} else {
				error.insertAfter(element).fadeOut(300).fadeIn(300);
			}
		},
		submitHandler: function(form) {
			$("#submitButton").attr("disabled", true);
			// 表单提交
			$(form).ajaxSubmit({
				dataType: "json",
				beforeSubmit: function(data) {
					$("#status").html('<span class="loadingIcon">&nbsp;</span>正在检测用户状态，请稍后...');
				},
				success: function(data) {
					if (data.status == "warn") {
						$("#status").html(data.message);
						var windowHtml = '<table class="windowInputTable"><tr><th>保护问题：</th><td>' + data.safeQuestion + '</td></tr><tr><th>问题回答：</th><td><input type="text" name="safeAnswerInput" class="formText {required: true, messages: {required: \'请填写密码保护回答！\'}}" /></td></tr><tr><th>&nbsp;</th><td><p id="safeQuestionStatus"></p><input type="button" id="safeQuestionButton" class="formButton" value="确  定" /></td></tr></table>';
						$.window("密码保护问题", windowHtml);
					} else if (data.status == "success") {
						$safeAnswer.val("");
						$("#status").html(data.message);
						$.closeWindow();
						$.message(data.status, data.message);
					} else {
						$("#status").html(data.message);
						$.message(data.status, data.message);
					}
					$("#submitButton").attr("disabled", false);
				}
			});
		}
	});
	
	// 提交表单
	$("#safeQuestionButton").livequery("click", function() {
		var safeAnswerVal = $("input[name='safeAnswerInput']").val();
		if ($.trim(safeAnswerVal) == "") {
			$.tip("请填写保护答案!");
			return false;
		}
		$safeAnswer.val(safeAnswerVal);
		$("#passwordRecoverForm").submit();
	})

})
</script>
</head>
<body>
<%include("/shop/header.html"){}%>
<div class="am-cf shop-main">
  <!-- content start -->
  <div class="shop-content">
    <div class="shop-content-body">
      <div class="am-panel am-panel-default">
        <div class="am-panel-hd am-text-center">找回密码</div>
        <div class="am-panel-bd">
          <form id="passwordRecoverForm" class="am-form am-form-horizontal" action="${base}/shop/member/sendPasswordRecoverMail" method="post">
          <input type="hidden" name="member.safeAnswer" />
          <div class="am-form-group">
            <label class="am-u-sm-3 am-form-label">用户名</label>
            <div class="am-u-sm-9">
              <input type="text" class="am-form-field" name="member.username" placeholder="请填写用户名!" required>
            </div>
          </div>
          <div class="am-form-group">
            <label class="am-u-sm-3 am-form-label">E-mail</label>
            <div class="am-u-sm-9">
              <input type="email" class="am-form-field" name="member.email" placeholder="请填写E-mail!" required>
            </div>
          </div>
          <div class="am-form-group">
            <div class="am-u-sm-9 am-u-sm-offset-3">
              <button type="submit" class="am-btn am-btn-default">确  定</button>
            </div>
            <div class="am-u-sm-9 am-u-sm-offset-3">
              如果忘记密码，请填写您的用户名和注册邮箱重新获取密码！
            </div>
          </div>
          </form>
        </div>
      </div>
    </div>
    <%include("/shop/footer.html"){}%>
  </div>
  <!-- content end -->
</body>
</html>